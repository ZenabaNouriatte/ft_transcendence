input {
  tcp {
    host  => "0.0.0.0"
    port  => 5000
    # Put parsed JSON at the root (do NOT wrap in [event])
    codec => json_lines
  }

  heartbeat {
    interval => 30
    message  => "alive"
    add_field => { "kind" => "heartbeat" "service" => "logstash" "level" => "info" "env" => "dev" }
  }
}

filter {
  # If your payload is {"event": {...}}, its timestamp is at [event][ts]
  if [event][ts] {
    date {
      match          => ["[event][ts]", "ISO8601"]
      target         => "@timestamp"
      tag_on_failure => []
    }
  }

  mutate {
    # Pull what you need to the root
    rename => {
      "[event][service]" => "service"
      "[event][env]"     => "env"
      "[event][level]"   => "level"
      "[event][msg]"     => "message"
      "[event][kind]"    => "kind"
      "[event][action]"  => "action"
    }

    # Optional but recommended to avoid mapping bloat:
    remove_field => ["event"]
  }
}

output {
  stdout { codec => rubydebug }
  elasticsearch {
    hosts    => ["http://elasticsearch:9200"]
    index    => "ftt-logs-%{+YYYY.MM.dd}"
    user     => "${ELASTICSEARCH_USERNAME}"
    password => "${ELASTICSEARCH_PASSWORD}"
  }
}
